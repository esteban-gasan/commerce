{% extends 'auctions/layout.html' %}

{% block title %}{{ item.name }} | Auctions{% endblock title %}

{% block body %}

{% if user.is_authenticated  %}
    <form action="{% url 'auctions:item' item.id %}" method="post">
        {% csrf_token %}
        {% if user not in saved_by %}
            <button class="btn btn-info btn-sm" type="submit" name="add-watchlist">
                Add to Watchlist
            </button>
        {% else %}
            <button class="btn btn-outline-danger btn-sm" type="submit" name="rm-watchlist">
                Remove from Watchlist
            </button>
        {% endif %}
    </form>
{% endif %}

<img src="{{ item.image_url }}" alt="item_image">
<p>{{ item.name }}</p>
<p>{{ item.description }}</p>

<p>{{ item.seller }}</p>

{% for category in categories %}
    <ul>{{ category }}</ul>
{% endfor %}

{% if item.active %}
    {% if highest_bid %}
        <p>Current bid: {{ highest_bid.bid_amount }}</p>
    {% else %}
        <p>Starting price: {{ item.starting_price }}</p>
    {% endif %}

    <p>{{ bids_count }} bid{{ bids_count|pluralize }} so far.</p>

    {% if highest_bid.bidder == user %}
        <p>Your bid is the current bid.</p>
    {% endif %}

    <form action="{% url 'auctions:item' item.id %}" method="post">
        {% csrf_token %}
        {% if item.seller == user %}
            <button class="btn btn-danger" type="submit" name="end-listing">End listing</button>
        {% else %}
            {% if bid_form.errors %}
                <div class="alert alert-danger" role="alert">
                    {{ bid_form.bid_amount.errors }}
                </div>
            {% endif %}
            {{ bid_form.bid_amount }}
            <button class="btn btn-primary" type="submit" name="place-bid">Place bid</button>
        {% endif %}
    </form>

{% else %}
    {% if item.winner == user %}
        <div class="alert alert-success" role="alert">
            Congratulations! You won this item.
        </div>
    {% else %}
    <div class="alert alert-warning" role="alert">
        Bidding has ended on this item.
    </div>
    {% endif %}

    {% if item.winning_bid_amount %}
        <p>Winning bid: {{ item.winning_bid_amount }}</p>
    {% endif %}
{% endif %}

<h5>Comments</h5>
<form action="{% url 'auctions:item' item.id %}" method="post">
    {% csrf_token %}
    {{ comment_form }}
    <button class="btn btn-secondary" type="submit" name="post-comment">Post comment</button>
</form>

{% for comment in comments %}
<ul>
    {{ comment.author }}
    {{ comment.date_posted }}
    {{ comment.text }}
</ul>
{% endfor %}

{% endblock body %}
